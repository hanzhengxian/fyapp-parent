<?xml version="1.0" encoding="GB2312" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>onway-gen-dal</tt>, a DAL (Data Access Layer)    -->
<!-- code generation utility specially developed for <tt>onway</tt> project.        -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>onway-gen-dal</tt> to generate this file.                                  -->
<!--                                                                               -->
<!-- @author guangdong.li                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="onway">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table hqyt_discount_user -->
    <resultMap id="RM-DISCOUNT-USER" class="com.onway.fyapp.common.dal.dataobject.DiscountUserDO">
		<result property="id" column="ID"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="userId" column="USER_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="discountTeamId" column="DISCOUNT_TEAM_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="discountId" column="DISCOUNT_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="discountName" column="DISCOUNT_NAME"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="discountType" column="DISCOUNT_TYPE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="discountBackground" column="DISCOUNT_BACKGROUND"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="amount.cent" column="AMOUNT"  javaType="long" jdbcType="DECIMAL" />
		<result property="limitAmount.cent" column="LIMIT_AMOUNT"  javaType="long" jdbcType="DECIMAL" />
		<result property="discount" column="DISCOUNT"  javaType="double" jdbcType="DOUBLE"  nullValue="0"/>
		<result property="timeEnd" column="TIME_END"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="linkTeam" column="LINK_TEAM"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="linkTeamChild" column="LINK_TEAM_CHILD"  javaType="java.lang.String" jdbcType="TEXT" />
		<result property="linkPro" column="LINK_PRO"  javaType="java.lang.String" jdbcType="TEXT" />
		<result property="discountSubType" column="DISCOUNT_SUB_TYPE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="canOverUse" column="CAN_OVER_USE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="canOverNums" column="CAN_OVER_NUMS"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="canTogeUse" column="CAN_TOGE_USE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="canTogeDisid" column="CAN_TOGE_DISID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="status" column="STATUS"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="canDiscountUse" column="CAN_DISCOUNT_USE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="gmtCreate" column="GMT_CREATE"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED"  javaType="java.util.Date" jdbcType="DATETIME" />
    </resultMap>


    <!-- ============================================= -->
    <!-- mapped statements for IbatisDiscountUserDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisDiscountUserDAO.queryList -->
			 <select id="MS-DISCOUNT-USER-QUERY-LIST" resultClass="java.util.HashMap">
	        SELECT 
        		hdu.GMT_CREATE getTime,
        		hdu.USER_ID userId,
        		hu.NICK_NAME nickName,
        		hu.REAL_NAME realName,
        		hu.CELL cell,
        		hdu.STATUS status,
        		hdu.TIME_END timeEnd
        	FROM hqyt_discount_user hdu LEFT JOIN hqyt_user hu ON hu.USER_ID = hdu.USER_ID
        	WHERE 1=1
        	<isNotEmpty property="discountId" prepend="AND">
	             hdu.DISCOUNT_ID = #discountId#
	        </isNotEmpty>
	        <isNotEmpty property="startDate" prepend="and">
			     <![CDATA[
			         hdu.GMT_CREATE >=  #startDate#
			     ]]>        
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			     <![CDATA[
			         hdu.GMT_CREATE <= #endDate#
			     ]]>      
			</isNotEmpty>
			<isNotEmpty prepend="and" property="useTypes"> 
				 hdu.STATUS IN
				 <iterate property="useTypes" open="(" close=")" conjunction="," > 
		        	#useTypes[]# 
		         </iterate>
		    </isNotEmpty>
        	ORDER BY hdu.GMT_CREATE DESC
	        <isNotEmpty property="offset">
                limit $offset$,$limit$
            </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisDiscountUserDAO.queryListCount -->
			 <select id="MS-DISCOUNT-USER-QUERY-LIST-COUNT" resultClass="int">
	        SELECT 
        		COUNT(1)
        	FROM hqyt_discount_user hdu LEFT JOIN hqyt_user hu ON hu.USER_ID = hdu.USER_ID
        	WHERE 1=1
        	<isNotEmpty property="discountId" prepend="AND">
	             hdu.DISCOUNT_ID = #discountId#
	        </isNotEmpty>
	        <isNotEmpty property="startDate" prepend="and">
			     <![CDATA[
			         hdu.GMT_CREATE >=  #startDate#
			     ]]>        
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			     <![CDATA[
			         hdu.GMT_CREATE <= #endDate#
			     ]]>      
			</isNotEmpty>
			<isNotEmpty prepend="and" property="useTypes"> 
				 hdu.STATUS IN
				 <iterate property="useTypes" open="(" close=")" conjunction="," > 
		        	#useTypes[]# 
		         </iterate>
		    </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisDiscountUserDAO.discountOutTime -->
    <update id="MS-DISCOUNT-USER-DISCOUNT-OUT-TIME">
        UPDATE 
				hqyt_discount_user 
			SET 
				STATUS = '2',
				GMT_MODIFIED = CURRENT_TIMESTAMP
			WHERE
				<![CDATA[
			         TIME_END < #dateTime#
			    ]]>
			AND STATUS = #status#
    </update>

</sqlMap>