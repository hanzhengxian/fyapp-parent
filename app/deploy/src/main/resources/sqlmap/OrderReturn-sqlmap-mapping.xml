<?xml version="1.0" encoding="GB2312" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>onway-gen-dal</tt>, a DAL (Data Access Layer)    -->
<!-- code generation utility specially developed for <tt>onway</tt> project.        -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>onway-gen-dal</tt> to generate this file.                                  -->
<!--                                                                               -->
<!-- @author guangdong.li                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="onway">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table hqyt_order_return -->
    <resultMap id="RM-ORDER-RETURN" class="com.onway.fyapp.common.dal.dataobject.OrderReturnDO">
		<result property="id" column="ID"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="childOrderId" column="CHILD_ORDER_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="carriCom" column="CARRI_COM"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="carriNo" column="CARRI_NO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="reason" column="REASON"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="reasonOther" column="REASON_OTHER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="returnImg" column="RETURN_IMG"  javaType="java.lang.String" jdbcType="TEXT" />
		<result property="moneyStatus" column="MONEY_STATUS"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="moneyMemo" column="MONEY_MEMO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="failReason" column="FAIL_REASON"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="returnVoucherImg" column="RETURN_VOUCHER_IMG"  javaType="java.lang.String" jdbcType="TEXT" />
		<result property="returnVoucherMemo" column="RETURN_VOUCHER_MEMO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="assUser" column="ASS_USER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="linkUser" column="LINK_USER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="linkCell" column="LINK_CELL"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="quartyUser" column="QUARTY_USER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="quartyImg" column="QUARTY_IMG"  javaType="java.lang.String" jdbcType="TEXT" />
		<result property="quartyDesc" column="QUARTY_DESC"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="succReason" column="SUCC_REASON"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="dealWay" column="DEAL_WAY"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="someFlg" column="SOME_FLG"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="cwnqUser" column="CWNQ_USER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="succCwnq" column="SUCC_CWNQ"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="status" column="STATUS"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="chooseNum" column="CHOOSE_NUM"  javaType="double" jdbcType="DOUBLE"  nullValue="0"/>
		<result property="shouldReturnMoney.cent" column="SHOULD_RETURN_MONEY"  javaType="long" jdbcType="DECIMAL" />
		<result property="needReturnFlg" column="NEED_RETURN_FLG"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="shouldReturnPoint.cent" column="SHOULD_RETURN_POINT"  javaType="long" jdbcType="DECIMAL" />
		<result property="shouldReturnVoucher.cent" column="SHOULD_RETURN_VOUCHER"  javaType="long" jdbcType="DECIMAL" />
		<result property="shouldReturnDevote.cent" column="SHOULD_RETURN_DEVOTE"  javaType="long" jdbcType="DECIMAL" />
		<result property="shouldReturnRebateUser.cent" column="SHOULD_RETURN_REBATE_USER"  javaType="long" jdbcType="DECIMAL" />
		<result property="shouldReturnRebateReco.cent" column="SHOULD_RETURN_REBATE_RECO"  javaType="long" jdbcType="DECIMAL" />
		<result property="shouldReturnRebateRecouser.cent" column="SHOULD_RETURN_REBATE_RECOUSER"  javaType="long" jdbcType="DECIMAL" />
		<result property="gmtCreate" column="GMT_CREATE"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="isSc" column="IS_SC"  javaType="boolean" jdbcType="BIT"  nullValue="false"/>
		<result property="gmtSc" column="GMT_SC"  javaType="java.util.Date" jdbcType="DATETIME" />
    </resultMap>


    <!-- ============================================= -->
    <!-- mapped statements for IbatisOrderReturnDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisOrderReturnDAO.selectByChildOrderId -->
			 <select id="MS-ORDER-RETURN-SELECT-BY-CHILD-ORDER-ID" resultMap="RM-ORDER-RETURN">
	    <![CDATA[
        select * from hqyt_order_return where (CHILD_ORDER_ID = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.getOrderReturnRecord -->
			 <select id="MS-ORDER-RETURN-GET-ORDER-RETURN-RECORD" resultClass="java.util.HashMap">
	        SELECT
					oor.CARRI_COM carriCom,
					oor.CARRI_NO carriNo,
					oor.REASON reason,
					oor.REASON_OTHER reasonOther,
					oor.RETURN_IMG returnImg,
					oor.MONEY_STATUS moneyStatus,
					oor.MONEY_MEMO moneyMemo,
					oor.FAIL_REASON failReason,
					oor.RETURN_VOUCHER_IMG returnVoucherImg,
					oor.RETURN_VOUCHER_MEMO returnVoucherMemo,
					ass.REAL_NAME assUserName,
					ass.CELL assUserCell,
					oor.LINK_USER linkUser,
					oor.LINK_CELL linkCell,
					oor.QUARTY_IMG quartuImg,
					oor.QUARTY_DESC quartyDesc,
					oor.SUCC_REASON succReason,
					oor.DEAL_WAY dealWay,
					cwnq.REAL_NAME cwnqUserName,
					cwnq.CELL cwnqUserCell,
					oor.SUCC_CWNQ succCwnq,
					oor.STATUS status,
					oor.CHOOSE_NUM chooseNum,
					oor.SHOULD_RETURN_MONEY shouldReturnMoney,
					oor.SHOULD_RETURN_POINT shouldReturnPoint,
					oor.SHOULD_RETURN_VOUCHER shouldReturnVoucher,
					oor.SHOULD_RETURN_DEVOTE shouldReturnDevote,
					oor.SHOULD_RETURN_REBATE_USER shouldReturnRebateUser,
					oor.SHOULD_RETURN_REBATE_RECO shouldReturnRebateReco,
					oor.SHOULD_RETURN_REBATE_RECOUSER shouldReturnRebateRecoUser,
					DATE_FORMAT(oor.GMT_CREATE,'%Y-%m-%d %k:%i:%S') gmtCreate,
					DATE_FORMAT(oor.GMT_MODIFIED,'%Y-%m-%d %k:%i:%S') gmtModified,
					quar.REAL_NAME quarUserName,
					quar.CELL quarUserCell
				FROM
					hqyt_order_return oor
				LEFT JOIN hqyt_user ass ON ass.USER_ID = oor.ASS_USER
				LEFT JOIN hqyt_user cwnq ON cwnq.USER_ID = oor.CWNQ_USER
				LEFT JOIN hqyt_user quar ON quar.USER_ID = oor.QUARTY_USER
				where 1=1 
				<isNotEmpty prepend="and" property="childOrderId"> 
				 	oor.CHILD_ORDER_ID = #childOrderId#
				</isNotEmpty>
				ORDER BY oor.GMT_CREATE DESC
	    		<isNotEmpty property="offset"> 
				 	LIMIT $offset$, $limit$
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.getOrderReturnRecordCount -->
			 <select id="MS-ORDER-RETURN-GET-ORDER-RETURN-RECORD-COUNT" resultClass="int">
	        SELECT
					COUNT(1)
				FROM
					hqyt_order_return oor
				LEFT JOIN hqyt_user ass ON ass.USER_ID = oor.ASS_USER
				LEFT JOIN hqyt_user cwnq ON cwnq.USER_ID = oor.CWNQ_USER
				LEFT JOIN hqyt_user quar ON quar.USER_ID = oor.QUARTY_USER
				where 1=1 
				<isNotEmpty prepend="and" property="childOrderId"> 
				 	oor.CHILD_ORDER_ID = #childOrderId#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.getOrderComplainRecord -->
			 <select id="MS-ORDER-RETURN-GET-ORDER-COMPLAIN-RECORD" resultClass="java.util.HashMap">
	        SELECT
					ht.TEAM_ID teamId, <!-- 门店 -->
					ht.TEAM_NAME teamName, <!-- 门店 -->
					ht.ERP_NO teamErpNo, <!-- 门店 -->
					IFNULL(cln_user.REAL_NAME,cln_user.NICK_NAME) cln_user_name, <!-- 顾客信息 -->
					cln_user.CELL cln_user_cell, <!-- 顾客信息 -->
					cln_user.USER_ID cln_user_userId, <!-- 顾客信息 -->
					DATE_FORMAT(hor.GMT_CREATE,'%Y-%m-%d %k:%i:%S') cln_time, <!-- 投诉时间-->
					hor.REASON reason, <!-- 退货原因 -->
					hor.REASON_OTHER reasonOther, <!-- 顾客备注-->
					hor.QUARTY_IMG quartyImg, <!-- 营业员描述图片 -->
					hor.QUARTY_DESC quartyDesc, <!-- 营业员质量问题描述 -->
					hor.LINK_USER linkUser, <!-- 投诉联系人信息-->
					hor.LINK_CELL linkCell, <!-- 投诉联系人信息-->
					IFNULL(acc_user.REAL_NAME,acc_user.NICK_NAME) acc_user_name, <!-- 质管信息 -->
					acc_user.CELL acc_user_cell, <!-- 质管信息 -->
					acc_user.USER_ID acc_user_userId, <!-- 质管信息 -->
					hor.SUCC_REASON acc_user_check_memo, <!-- 质管审核备注 -->
					IFNULL(cwnq_user.REAL_NAME,cwnq_user.NICK_NAME) cwnq_user_name, <!-- 财务内勤信息 -->
					cwnq_user.CELL cwnq_user_cell, <!-- 财务内勤信息 -->
					cwnq_user.USER_ID cwnq_user_userId, <!-- 财务内勤信息 -->
					hor.SUCC_CWNQ cwnq_user_check_memo, <!-- 财务内勤审核理由-->
					hor.STATUS status, <!-- 状态 -->
					hor.RETURN_IMG returnImg, <!-- 顾客描述图片 -->
					hor.RETURN_VOUCHER_IMG returnVoucherImg, <!-- 营业员退款凭证 -->
					hor.RETURN_VOUCHER_MEMO returnVoucherMemo, <!-- 营业员退款凭证图片 -->
					hp.PRODUCT_ID productId, <!-- 商品信息 -->
					hp.PRO_NAME productName, <!-- 商品信息 -->
					hor.DEAL_WAY dealWay, <!-- 质管处理方式 -->
					ho.CHILD_ORDER_ID orderId, <!-- 子订单号-->
					ho.ORDER_ID orderNo, <!-- 订单号-->
					ho.ORDER_COUNT orderCount, <!-- 订单数量 -->
					hor.CHOOSE_NUM returnCount, <!-- 退货数量 -->
					hp.SPECIFICATION specification,
					hp.UNIT unit,
					hp.ERP_NO productErpNo, <!-- 商品信息 -->
					ass_user.REAL_NAME assUserName, <!-- 营业员信息-->
					ass_user.CELL assUserCell, <!-- 营业员信息-->
					hor.FAIL_REASON failReason  <!-- 营业员审核备注-->
				FROM
					hqyt_order_return hor
				LEFT JOIN hqyt_order ho ON ho.CHILD_ORDER_ID = hor.CHILD_ORDER_ID
				LEFT JOIN hqyt_team  ht ON ht.TEAM_ID = ho.TEAM_ID
				LEFT JOIN hqyt_user  cln_user ON cln_user.USER_ID = ho.USER_ID
				LEFT JOIN hqyt_user  acc_user ON acc_user.USER_ID = hor.QUARTY_USER
				LEFT JOIN hqyt_user  cwnq_user ON cwnq_user.USER_ID = hor.CWNQ_USER
				LEFT JOIN hqyt_user  ass_user ON ass_user.USER_ID = hor.ASS_USER
				LEFT JOIN hqyt_product hp ON hp.PRODUCT_ID =  ho.PRODUCT_ID
				WHERE 1=1
				<isNotEmpty prepend="and" property="reasonMain"> 
				 		hor.REASON like '%$reasonMain$%'
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamIds"> 
						ho.TEAM_ID IN
						<iterate property="teamIds" open="(" close=")" conjunction="," > 
					        	#teamIds[]# 
					    </iterate>
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="userMsg">
						CONCAT_WS(&apos; &apos;,cln_user.USER_ID,cln_user.NICK_NAME,cln_user.CELL,cln_user.REAL_NAME) like "%$userMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="operMsg">
						CONCAT_WS(&apos; &apos;,ass_user.USER_ID,ass_user.NICK_NAME,ass_user.CELL,ass_user.REAL_NAME,ass_user.ERP_NO) like "%$operMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="proMsg">
						CONCAT_WS(&apos; &apos;,hp.PRODUCT_ID,hp.ERP_NO,hp.PRODUCT_NAME,hp.PRO_NAME) like "%$proMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="conStatus"> 
						hor.STATUS IN
						<iterate property="conStatus" open="(" close=")" conjunction="," > 
					        	#conStatus[]# 
					    </iterate>
				</isNotEmpty>
				<isNotEmpty property="startDate" prepend="and">
					    <![CDATA[
					       hor.GMT_CREATE >= #startDate#
					    ]]>      
				</isNotEmpty>
				<isNotEmpty property="endDate" prepend="and">
					    <![CDATA[
					       hor.GMT_CREATE < #endDate#
					    ]]>      
				</isNotEmpty>
				ORDER BY hor.GMT_CREATE DESC
	    		<isNotEmpty property="offset"> 
				 	LIMIT $offset$, $limit$
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.getOrderComplainRecordCount -->
			 <select id="MS-ORDER-RETURN-GET-ORDER-COMPLAIN-RECORD-COUNT" resultClass="int">
	        SELECT
					COUNT(1)
				FROM
					hqyt_order_return hor
				LEFT JOIN hqyt_order ho ON ho.CHILD_ORDER_ID = hor.CHILD_ORDER_ID
				LEFT JOIN hqyt_team  ht ON ht.TEAM_ID = ho.TEAM_ID
				LEFT JOIN hqyt_user  cln_user ON cln_user.USER_ID = ho.USER_ID
				LEFT JOIN hqyt_user  acc_user ON acc_user.USER_ID = hor.QUARTY_USER
				LEFT JOIN hqyt_user  cwnq_user ON cwnq_user.USER_ID = hor.CWNQ_USER
				LEFT JOIN hqyt_user  ass_user ON ass_user.USER_ID = hor.ASS_USER
				LEFT JOIN hqyt_product hp ON hp.PRODUCT_ID =  ho.PRODUCT_ID
				WHERE 1=1
				<isNotEmpty prepend="and" property="reasonMain"> 
				 		hor.REASON like '%$reasonMain$%'
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamIds"> 
						ho.TEAM_ID IN
						<iterate property="teamIds" open="(" close=")" conjunction="," > 
					        	#teamIds[]# 
					    </iterate>
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="userMsg">
						CONCAT_WS(&apos; &apos;,cln_user.USER_ID,cln_user.NICK_NAME,cln_user.CELL,cln_user.REAL_NAME) like "%$userMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="operMsg">
						CONCAT_WS(&apos; &apos;,ass_user.USER_ID,ass_user.NICK_NAME,ass_user.CELL,ass_user.REAL_NAME,ass_user.ERP_NO) like "%$operMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="proMsg">
						CONCAT_WS(&apos; &apos;,hp.PRODUCT_ID,hp.ERP_NO,hp.PRODUCT_NAME,hp.PRO_NAME) like "%$proMsg$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="conStatus"> 
						hor.STATUS IN
						<iterate property="conStatus" open="(" close=")" conjunction="," > 
					        	#conStatus[]# 
					    </iterate>
				</isNotEmpty>
				<isNotEmpty property="startDate" prepend="and">
					    <![CDATA[
					       hor.GMT_CREATE >= #startDate#
					    ]]>      
				</isNotEmpty>
				<isNotEmpty property="endDate" prepend="and">
					    <![CDATA[
					       hor.GMT_CREATE < #endDate#
					    ]]>      
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.sumAmountOrderReturnSucc -->
			 <select id="MS-ORDER-RETURN-SUM-AMOUNT-ORDER-RETURN-SUCC" resultClass="java.math.BigDecimal">
	        SELECT
					IFNULL(
						SUM(SHOULD_RETURN_MONEY),0
					)
				FROM
					hqyt_order_return
				WHERE 1=1 
				<isNotEmpty prepend="and" property="childOrderId"> 
				 	CHILD_ORDER_ID = #childOrderId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="status"> 
				 	STATUS = #status#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisOrderReturnDAO.sumAmountOrderReturnSuccIds -->
			 <select id="MS-ORDER-RETURN-SUM-AMOUNT-ORDER-RETURN-SUCC-IDS" resultClass="java.math.BigDecimal">
	        SELECT
					IFNULL(
						SUM(SHOULD_RETURN_MONEY),0
					)
				FROM
					hqyt_order_return
				WHERE 1=1 
				<isNotEmpty prepend="and" property="childOrderIds"> 
				 	CHILD_ORDER_ID IN
					<iterate property="childOrderIds" open="(" close=")" conjunction="," > 
		        		#childOrderIds[]# 
		        	</iterate>
		    	</isNotEmpty>
				<isNotEmpty prepend="and" property="status"> 
				 	STATUS = #status#
				</isNotEmpty>
    </select>

</sqlMap>