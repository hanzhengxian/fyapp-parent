<?xml version="1.0" encoding="GB2312" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>onway-gen-dal</tt>, a DAL (Data Access Layer)    -->
<!-- code generation utility specially developed for <tt>onway</tt> project.        -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>onway-gen-dal</tt> to generate this file.                                  -->
<!--                                                                               -->
<!-- @author guangdong.li                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="onway">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table hqyt_team -->
    <resultMap id="RM-TEAM" class="com.onway.fyapp.common.dal.dataobject.TeamDO">
		<result property="id" column="ID"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="teamId" column="TEAM_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="teamName" column="TEAM_NAME"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="teamType" column="TEAM_TYPE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="topTeamId" column="TOP_TEAM_ID"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="isTop" column="IS_TOP"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="cell" column="CELL"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="address" column="ADDRESS"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="longitude" column="LONGITUDE"  javaType="double" jdbcType="DOUBLE"  nullValue="0"/>
		<result property="latitude" column="LATITUDE"  javaType="double" jdbcType="DOUBLE"  nullValue="0"/>
		<result property="favourableActive" column="FAVOURABLE_ACTIVE"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="delFlg" column="DEL_FLG"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="erpNo" column="ERP_NO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="teamLevel" column="TEAM_LEVEL"  javaType="int" jdbcType="INT"  nullValue="0"/>
		<result property="city" column="CITY"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="voucherLimit" column="VOUCHER_LIMIT"  javaType="long" jdbcType="DECIMAL"  nullValue="0"/>
		<result property="teamAllName" column="TEAM_ALL_NAME"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="chargePersonName" column="CHARGE_PERSON_NAME"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="chargePersonCell" column="CHARGE_PERSON_CELL"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="taxNo" column="TAX_NO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="bankName" column="BANK_NAME"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="bankNo" column="BANK_NO"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="gmtCreate" column="GMT_CREATE"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED"  javaType="java.util.Date" jdbcType="DATETIME" />
		<result property="creater" column="CREATER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="modifier" column="MODIFIER"  javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="businessCategory" column="BUSINESS_CATEGORY"  javaType="java.lang.String" jdbcType="VARCHAR" />
    </resultMap>


    <!-- ============================================= -->
    <!-- mapped statements for IbatisTeamDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisTeamDAO.selectTeam -->
			 <select id="MS-TEAM-SELECT-TEAM" resultClass="java.util.HashMap">
	        SELECT  
				DISTINCT
					ht.ID id,
				    ht.TEAM_ID teamId,
					ht.TEAM_NAME teamName,
					ht.TEAM_TYPE teamType,
					ht.TOP_TEAM_ID topTeamId,
					(SELECT TEAM_NAME FROM hqyt_team t WHERE t.TEAM_ID = ht.TOP_TEAM_ID) topTeamName,
					ht.IS_TOP isTop,
					ht.CELL cell,
					ht.ADDRESS address,
					ht.LONGITUDE longitude,
					ht.LATITUDE latitude,
					ht.FAVOURABLE_ACTIVE favourableActive,
					ht.DEL_FLG delFlg,
					ht.ERP_NO erpNo,
					ht.TEAM_LEVEL teamLevel,
					ht.CITY city ,
					ht.VOUCHER_LIMIT voucherLimit,
					ht.GMT_CREATE gmtCreate,
					ht.GMT_MODIFIED gmtModified,
					hi.IMG_URL imgUrl,
					ht.TEAM_ALL_NAME teamAllName,
					ht.CHARGE_PERSON_NAME  chargePersonName,
					ht.CHARGE_PERSON_CELL  chargePersonCell,
					ht.TAX_NO taxNo,
					ht.BANK_NAME  bankName,
					ht.BANK_NO  bankNo,
					ht.BUSINESS_CATEGORY businessCategory,
					(SELECT USERNAME FROM sys_role_user scu WHERE scu.USER_ID = ht.CREATER) creater, 
					(SELECT USERNAME FROM sys_role_user smu WHERE smu.USER_ID = ht.MODIFIER) modifier,
					IFNULL(ha.DEVOTE_AMOUNT,0) devoteAmount,
					IFNULL(ha.HU_POINT,0) point,
					IFNULL(ha.RE_POINT,0) repoint
				FROM
					hqyt_team ht
				LEFT JOIN hqyt_team_user htu ON htu.TEAM_ID = ht.TEAM_ID
				LEFT JOIN hqyt_user hu ON hu.USER_ID = htu.TEAM_USER_ID
				LEFT JOIN hqyt_img hi ON hi.IMG_ID = ht.TEAM_ID
				LEFT JOIN hqyt_team_check htc ON htc.TEAM_ID = ht.TEAM_ID
				LEFT JOIN hqyt_user huc ON huc.USER_ID = htc.TEAM_USER_ID
				LEFT JOIN hqyt_account ha ON ha.LINK_ID = ht.TEAM_ID
				WHERE 1=1
				<isNotEmpty prepend="and" property="userCell"> 
					hu.CELL like "%$userCell$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="nickName"> 
					hu.NICK_NAME like "%$nickName$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamErpNo"> 
					ht.ERP_NO like "%$teamErpNo$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamName"> 
					ht.TEAM_NAME like "%$teamName$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamType"> 
					ht.TEAM_TYPE = #teamType#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamLevel"> 
					ht.TEAM_LEVEL = #teamLevel#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="isTop"> 
					ht.IS_TOP = #isTop#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="delflg"> 
					ht.DEL_FLG = #delflg#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="realName"> 
					hu.REAL_NAME like "%$realName$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="teamIdFather"> 
					ht.TOP_TEAM_ID = #teamIdFather#
				</isNotEmpty>
				
				<isNotEmpty prepend="and" property="teamCheckRole"> 
					<!-- htc.CHECK_LEDER &lt;&gt; #teamCheckRole# -->
					ht.TEAM_ID NOT IN (SELECT TEAM_ID FROM hqyt_team_check WHERE CHECK_LEDER = #teamCheckRole#)
				</isNotEmpty>
				
				<isNotEmpty prepend="and" property="teamCheckCell"> 
					huc.CELL like "%$teamCheckCell$%"
				</isNotEmpty>
				
				<isEqual prepend="" property="hasChooseForDiscount" compareValue = "0">
		        	<isNotEmpty prepend="and" property="linkTeamIds"> 
					 	ht.TEAM_ID IN
						<iterate property="linkTeamIds" open="(" close=")" conjunction="," > 
			        		#linkTeamIds[]# 
			        	</iterate>
		    		</isNotEmpty>
		        </isEqual>
		        <isEqual prepend="" property="hasChooseForDiscount" compareValue = "1">
		        	<isNotEmpty prepend="and" property="linkTeamIds"> 
					 	ht.TEAM_ID NOT IN
						<iterate property="linkTeamIds" open="(" close=")" conjunction="," > 
			        		#linkTeamIds[]# 
			        	</iterate>
		    		</isNotEmpty>
		        </isEqual>
		        
					ORDER BY ht.GMT_CREATE DESC,ht.ID DESC
				<isNotEmpty prepend="" property="limit"> 
					limit #offset#,#limit#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamCount -->
			 <select id="MS-TEAM-SELECT-TEAM-COUNT" resultClass="int">
	        SELECT  
					COUNT(1)
				FROM	
				(
					SELECT  
					DISTINCT
						ht.*
					FROM
						hqyt_team ht
					LEFT JOIN hqyt_team_user htu ON htu.TEAM_ID = ht.TEAM_ID
					LEFT JOIN hqyt_user hu ON hu.USER_ID = htu.TEAM_USER_ID
					LEFT JOIN hqyt_team_check htc ON htc.TEAM_ID = ht.TEAM_ID
					LEFT JOIN hqyt_user huc ON huc.USER_ID = htc.TEAM_USER_ID
					LEFT JOIN hqyt_account ha ON ha.LINK_ID = ht.TEAM_ID
					WHERE 1=1
					<isNotEmpty prepend="and" property="userCell"> 
						hu.CELL like "%$userCell$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="nickName"> 
						hu.NICK_NAME like "%$nickName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamErpNo"> 
						ht.ERP_NO like "%$teamErpNo$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamName"> 
						ht.TEAM_NAME like "%$teamName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamType"> 
						ht.TEAM_TYPE = #teamType#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamLevel"> 
						ht.TEAM_LEVEL = #teamLevel#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="isTop"> 
						ht.IS_TOP = #isTop#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="delflg"> 
						ht.DEL_FLG = #delflg#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="realName"> 
						hu.REAL_NAME like "%$realName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamIdFather"> 
						ht.TOP_TEAM_ID = #teamIdFather#
					</isNotEmpty>
					
					<isNotEmpty prepend="and" property="teamCheckRole"> 
						<!-- htc.CHECK_LEDER &lt;&gt; #teamCheckRole# -->
						ht.TEAM_ID NOT IN (SELECT TEAM_ID FROM hqyt_team_check WHERE CHECK_LEDER = #teamCheckRole#)
					</isNotEmpty>
				
					<isNotEmpty prepend="and" property="teamCheckCell"> 
						huc.CELL like "%$teamCheckCell$%"
					</isNotEmpty>
					
					<isEqual prepend="" property="hasChooseForDiscount" compareValue = "0">
			        	<isNotEmpty prepend="and" property="linkTeamIds"> 
						 	ht.TEAM_ID IN
							<iterate property="linkTeamIds" open="(" close=")" conjunction="," > 
				        		#linkTeamIds[]# 
				        	</iterate>
			    		</isNotEmpty>
			        </isEqual>
			        <isEqual prepend="" property="hasChooseForDiscount" compareValue = "1">
			        	<isNotEmpty prepend="and" property="linkTeamIds"> 
						 	ht.TEAM_ID NOT IN
							<iterate property="linkTeamIds" open="(" close=")" conjunction="," > 
				        		#linkTeamIds[]# 
				        	</iterate>
			    		</isNotEmpty>
			        </isEqual>
				) aa
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamUserList -->
			 <select id="MS-TEAM-SELECT-TEAM-USER-LIST" resultMap="RM-TEAM">
	        SELECT
					htu.TEAM_USER_ID,
					htu.TEAM_LEDER,
					hu.OPEN_ID,
					hu.HEAD_URL,
					hu.CELL,
					hu.NICK_NAME,
					hu.SEX,
					hu.AGE,
					hu.CERT_NO,
					hu.BIRTHDAY,
					hu.COM_NAME,
					hu.USER_LEVEL,
					hu.RECOMMEND_USER_ID,
					hu.RECOMMEND_USER_TYPE,
					hu.DEL_FLG,
					hu.IS_NEW,
					hu.LOGIN_PSW,
					hu.CAN_WITHDRAW,
					hu.GMT_CREATE,
					hu.GMT_MODIFIED
				FROM
					hqyt_team ht
				LEFT JOIN hqyt_team_user htu ON htu.TEAM_ID = ht.TEAM_ID
				LEFT JOIN hqyt_user hu ON hu.USER_ID = htu.TEAM_USER_ID
				WHERE
					ht.TEAM_ID = #teamId#
				<isNotEmpty prepend="and" property="userId"> 
					htu.TEAM_USER_ID = #userId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="nickName"> 
					hu.NICK_NAME like "%$nickName$%"
				</isNotEmpty>
				<isNotEmpty prepend="and" property="cell"> 
					hu.CELL = #cell#
				</isNotEmpty>
					ORDER BY hu.GMT_CREATE DESC
				<isNotEmpty prepend="" property="limit"> 
					limit #offset#,#limit#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectAllTeam -->
			 <select id="MS-TEAM-SELECT-ALL-TEAM" resultMap="RM-TEAM">
	    <![CDATA[
        select * from hqyt_team where (DEL_FLG = '0')
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.insertteam -->
    <insert id="MS-TEAM-INSERTTEAM">
    <![CDATA[
        insert into hqyt_team(TEAM_ID,TEAM_NAME,TEAM_TYPE,TOP_TEAM_ID,IS_TOP,CELL,ADDRESS,LONGITUDE,LATITUDE,FAVOURABLE_ACTIVE,DEL_FLG,ERP_NO,TEAM_LEVEL,CITY,TEAM_ALL_NAME,CHARGE_PERSON_NAME,CHARGE_PERSON_CELL,TAX_NO,BANK_NAME,BANK_NO,BUSINESS_CATEGORY,GMT_CREATE,GMT_MODIFIED,CREATER) values (#teamId#, #teamName#, #teamType#, #topTeamId#, #isTop#, #cell#, #address#, #longitude#, #latitude#, #favourableActive#, #delFlg#, #erpNo#, #teamLevel#, #city#, #teamAllName#, #chargePersonName#, #chargePersonCell#, #taxNo#, #bankName#, #bankNo#, #businessCategory#, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, #creater#)
    ]]>
	<selectKey resultClass="int" keyProperty="id">
       select last_insert_id() as id
    </selectKey>
    </insert>

    <!-- mapped statement for IbatisTeamDAO.updateteam -->
    <update id="MS-TEAM-UPDATETEAM">
    <![CDATA[
        update hqyt_team set TEAM_NAME=#teamName#, TEAM_TYPE=#teamType#, CELL=#cell#, ADDRESS=#address#, LONGITUDE=#longitude#, TOP_TEAM_ID=#topTeamId#, IS_TOP=#isTop#, LATITUDE=#latitude#, FAVOURABLE_ACTIVE=#favourableActive#, TEAM_LEVEL=#teamLevel#, ERP_NO=#erpNo#, CITY=#city#, TEAM_ALL_NAME=#teamAllName#, CHARGE_PERSON_NAME=#chargePersonName#, CHARGE_PERSON_CELL=#chargePersonCell#, TAX_NO=#taxNo#, BANK_NAME=#bankName#, BANK_NO=#bankNo#, BUSINESS_CATEGORY=#businessCategory#, MODIFIER=#modifier#, GMT_MODIFIED=CURRENT_TIMESTAMP where (TEAM_ID = #teamId#)
    ]]>
    </update>

    <!-- mapped statement for IbatisTeamDAO.deleteteam -->
    <update id="MS-TEAM-DELETETEAM">
    <![CDATA[
        update hqyt_team set DEL_FLG='1', MODIFIER=#modifier#, GMT_MODIFIED=CURRENT_TIMESTAMP where (TEAM_ID = #teamId#)
    ]]>
    </update>

    <!-- mapped statement for IbatisTeamDAO.findtop -->
			 <select id="MS-TEAM-FINDTOP" resultMap="RM-TEAM">
	        select * from hqyt_team where  hqyt_team.DEL_FLG='0' AND  hqyt_team.IS_TOP='1'
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTopTeam -->
			 <select id="MS-TEAM-SELECT-TOP-TEAM" resultMap="RM-TEAM">
	    <![CDATA[
        select * from hqyt_team where ((DEL_FLG = '0') AND (IS_TOP = '1'))
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectByTeamId -->
			 <select id="MS-TEAM-SELECT-BY-TEAM-ID" resultMap="RM-TEAM">
	    <![CDATA[
        select * from hqyt_team where (TEAM_ID = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.checktel -->
			 <select id="MS-TEAM-CHECKTEL" resultClass="int">
	        select
				 count(1) 
			from
				hqyt_team
			where 1 = 1
				<isNotEmpty prepend="and" property="cell"> 
				 	CELL = #cell#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamByCell -->
			 <select id="MS-TEAM-SELECT-TEAM-BY-CELL" resultMap="RM-TEAM">
	    <![CDATA[
        select * from hqyt_team where (CELL = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamByTopId -->
			 <select id="MS-TEAM-SELECT-TEAM-BY-TOP-ID" resultClass="int">
	    <![CDATA[
        select count(1) from hqyt_team where (TOP_TEAM_ID = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamByErpNo -->
			 <select id="MS-TEAM-SELECT-TEAM-BY-ERP-NO" resultMap="RM-TEAM">
	    <![CDATA[
        select * from hqyt_team where (ERP_NO = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.queryAllTeam -->
			 <select id="MS-TEAM-QUERY-ALL-TEAM" resultMap="RM-TEAM">
	        SELECT  
					*	
				FROM
					hqyt_team
				WHERE 1=1
				<isNotEmpty prepend="AND" property="teamType"> 
					TEAM_TYPE = #teamType#
				</isNotEmpty>
				<isNotEmpty prepend="" property="startRow"> 
					limit #startRow#,#pageSize#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.queryAllTeamCount -->
			 <select id="MS-TEAM-QUERY-ALL-TEAM-COUNT" resultClass="int">
	        SELECT  
					COUNT(1)	
				FROM
					hqyt_team
				WHERE 1=1
				<isNotEmpty prepend="AND" property="teamType"> 
					TEAM_TYPE = #teamType#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.updateTeamLevel -->
    <update id="MS-TEAM-UPDATE-TEAM-LEVEL">
    <![CDATA[
        update hqyt_team set TEAM_LEVEL=#teamLevel#, GMT_MODIFIED=CURRENT_TIMESTAMP where (TEAM_ID = #teamId#)
    ]]>
    </update>

    <!-- mapped statement for IbatisTeamDAO.queryAllTeamForTop -->
			 <select id="MS-TEAM-QUERY-ALL-TEAM-FOR-TOP" resultMap="RM-TEAM">
	        SELECT
		        ID,
				TEAM_ID,
				TEAM_NAME,
				TEAM_TYPE,
				TOP_TEAM_ID,
				IS_TOP,
				CELL,
				ADDRESS,
				LONGITUDE,
				LATITUDE,
				FAVOURABLE_ACTIVE,
				DEL_FLG,
				ERP_NO,
				TEAM_LEVEL,
				CITY,
				VOUCHER_LIMIT,
				TEAM_ALL_NAME,
				CHARGE_PERSON_NAME,
				CHARGE_PERSON_CELL,
				TAX_NO,
				BANK_NAME,
				BANK_NO,
				BUSINESS_CATEGORY,
				GMT_CREATE,
				GMT_MODIFIED,
				CREATER,
				MODIFIER
			FROM hqyt_team
            WHERE 1=1
	        <isNotEmpty property="topTeamId" prepend="and">
	               (TOP_TEAM_ID = #topTeamId# OR TEAM_ID = #topTeamId#)
	        </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.queryFoTeamIdArray -->
			 <select id="MS-TEAM-QUERY-FO-TEAM-ID-ARRAY" resultClass="java.lang.String">
	        SELECT
					TEAM_ID
				FROM
					hqyt_team
				WHERE 1=1 
				<isNotEmpty property="teamName">
	    			AND TEAM_NAME like "%$teamName$%"
	    		</isNotEmpty>
				<isNotEmpty property="teamErpNo">
	    			AND ERP_NO like "%$teamErpNo$%"
	    		</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamMix -->
			 <select id="MS-TEAM-SELECT-TEAM-MIX" resultClass="java.util.HashMap">
	        SELECT * FROM
				(
					SELECT  
					DISTINCT
						ht.ID id,
					    ht.TEAM_ID teamId,
						ht.TEAM_NAME teamName,
						ht.TEAM_TYPE teamType,
						ht.TOP_TEAM_ID topTeamId,
						(SELECT TEAM_NAME FROM hqyt_team t WHERE t.TEAM_ID = ht.TOP_TEAM_ID) topTeamName,
						ht.IS_TOP isTop,
						ht.CELL cell,
						ht.ADDRESS address,
						ht.LONGITUDE longitude,
						ht.LATITUDE latitude,
						ht.FAVOURABLE_ACTIVE favourableActive,
						ht.DEL_FLG delFlg,
						ht.ERP_NO erpNo,
						ht.TEAM_LEVEL teamLevel,
						ht.CITY city ,
						ht.VOUCHER_LIMIT voucherLimit,
						ht.GMT_CREATE gmtCreate,
						ht.GMT_MODIFIED gmtModified,
						hi.IMG_URL imgUrl,
						ht.TEAM_ALL_NAME teamAllName,
						ht.CHARGE_PERSON_NAME  chargePersonName,
						ht.CHARGE_PERSON_CELL  chargePersonCell,
						ht.TAX_NO taxNo,
						ht.BANK_NAME  bankName,
						ht.BANK_NO  bankNo,
						ht.BUSINESS_CATEGORY businessCategory,
						(SELECT USERNAME FROM sys_role_user scu WHERE scu.USER_ID = ht.CREATER) creater, 
						(SELECT USERNAME FROM sys_role_user smu WHERE smu.USER_ID = ht.MODIFIER) modifier
						<isNotEmpty property="teamIdArray" prepend=",">
							is_mixed (
								ht.TEAM_ID,
								#teamIdArray#
							) AS hasMix
						</isNotEmpty>
						<isEmpty property="teamIdArray" prepend=",">
							'0' AS hasMix
						</isEmpty>
					FROM
						hqyt_team ht
					LEFT JOIN hqyt_team_user htu ON htu.TEAM_ID = ht.TEAM_ID
					LEFT JOIN hqyt_user hu ON hu.USER_ID = htu.TEAM_USER_ID
					LEFT JOIN hqyt_img hi ON hi.IMG_ID = ht.TEAM_ID
					WHERE 1=1
					<isNotEmpty prepend="and" property="userCell"> 
						hu.CELL like "%$userCell$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="nickName"> 
						hu.NICK_NAME like "%$nickName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamErpNo"> 
						ht.ERP_NO like "%$teamErpNo$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamName"> 
						ht.TEAM_NAME like "%$teamName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamType"> 
						ht.TEAM_TYPE = #teamType#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamLevel"> 
						ht.TEAM_LEVEL = #teamLevel#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="isTop"> 
						ht.IS_TOP = #isTop#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="delflg"> 
						ht.DEL_FLG = #delflg#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="realName"> 
						hu.REAL_NAME like "%$realName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamIdFather"> 
						ht.TOP_TEAM_ID = #teamIdFather#
					</isNotEmpty>
				) result
				WHERE 1=1
				<isNotEmpty property="teamIdArray" prepend="and">
	              	  result.hasMix = 1
		        </isNotEmpty>
		        ORDER BY result.gmtCreate DESC
				<isNotEmpty prepend="" property="limit"> 
					limit #offset#,#limit#
				</isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.selectTeamMixCount -->
			 <select id="MS-TEAM-SELECT-TEAM-MIX-COUNT" resultClass="int">
	        SELECT  
					COUNT(1)
				FROM	
				(
					SELECT  
					DISTINCT
						ht.ID id,
					    ht.TEAM_ID teamId,
						ht.TEAM_NAME teamName,
						ht.TEAM_TYPE teamType,
						ht.TOP_TEAM_ID topTeamId,
						(SELECT TEAM_NAME FROM hqyt_team t WHERE t.TEAM_ID = ht.TOP_TEAM_ID) topTeamName,
						ht.IS_TOP isTop,
						ht.CELL cell,
						ht.ADDRESS address,
						ht.LONGITUDE longitude,
						ht.LATITUDE latitude,
						ht.FAVOURABLE_ACTIVE favourableActive,
						ht.DEL_FLG delFlg,
						ht.ERP_NO erpNo,
						ht.TEAM_LEVEL teamLevel,
						ht.CITY city ,
						ht.VOUCHER_LIMIT voucherLimit,
						ht.GMT_CREATE gmtCreate,
						ht.GMT_MODIFIED gmtModified,
						hi.IMG_URL imgUrl,
						ht.TEAM_ALL_NAME teamAllName,
						ht.CHARGE_PERSON_NAME  chargePersonName,
						ht.CHARGE_PERSON_CELL  chargePersonCell,
						ht.TAX_NO taxNo,
						ht.BANK_NAME  bankName,
						ht.BANK_NO  bankNo,
						ht.BUSINESS_CATEGORY businessCategory,
						(SELECT USERNAME FROM sys_role_user scu WHERE scu.USER_ID = ht.CREATER) creater, 
						(SELECT USERNAME FROM sys_role_user smu WHERE smu.USER_ID = ht.MODIFIER) modifier
						<isNotEmpty property="teamIdArray" prepend=",">
							is_mixed (
								ht.TEAM_ID,
								#teamIdArray#
							) AS hasMix
						</isNotEmpty>
						<isEmpty property="teamIdArray" prepend=",">
							'0' AS hasMix
						</isEmpty>
					FROM
						hqyt_team ht
					LEFT JOIN hqyt_team_user htu ON htu.TEAM_ID = ht.TEAM_ID
					LEFT JOIN hqyt_user hu ON hu.USER_ID = htu.TEAM_USER_ID
					LEFT JOIN hqyt_img hi ON hi.IMG_ID = ht.TEAM_ID
					WHERE 1=1
					<isNotEmpty prepend="and" property="userCell"> 
						hu.CELL like "%$userCell$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="nickName"> 
						hu.NICK_NAME like "%$nickName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamErpNo"> 
						ht.ERP_NO like "%$teamErpNo$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamName"> 
						ht.TEAM_NAME like "%$teamName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamType"> 
						ht.TEAM_TYPE = #teamType#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamLevel"> 
						ht.TEAM_LEVEL = #teamLevel#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="isTop"> 
						ht.IS_TOP = #isTop#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="delflg"> 
						ht.DEL_FLG = #delflg#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="realName"> 
						hu.REAL_NAME like "%$realName$%"
					</isNotEmpty>
					<isNotEmpty prepend="and" property="teamIdFather"> 
						ht.TOP_TEAM_ID = #teamIdFather#
					</isNotEmpty>
				) result
				WHERE 1=1
			    <isNotEmpty property="teamIdArray" prepend="and">
		              result.hasMix = 1
		        </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.resumTeam -->
    <update id="MS-TEAM-RESUM-TEAM">
    <![CDATA[
        update hqyt_team set DEL_FLG='0', MODIFIER=#modifier#, GMT_MODIFIED=CURRENT_TIMESTAMP where (TEAM_ID = #teamId#)
    ]]>
    </update>

    <!-- mapped statement for IbatisTeamDAO.getNotDealChildTeam -->
			 <select id="MS-TEAM-GET-NOT-DEAL-CHILD-TEAM" resultClass="int">
	    <![CDATA[
        select count(1) from hqyt_team where ((TOP_TEAM_ID = #topTeamId#) AND (DEL_FLG = #delFlg#))
    ]]>
    </select>

    <!-- mapped statement for IbatisTeamDAO.queryTeamByTeamId -->
			 <select id="MS-TEAM-QUERY-TEAM-BY-TEAM-ID" resultMap="RM-TEAM">
	        SELECT
		        ID,
				TEAM_ID,
				TEAM_NAME,
				TEAM_TYPE,
				TOP_TEAM_ID,
				IS_TOP,
				CELL,
				ADDRESS,
				LONGITUDE,
				LATITUDE,
				FAVOURABLE_ACTIVE,
				DEL_FLG,
				ERP_NO,
				TEAM_LEVEL,
				CITY,
				VOUCHER_LIMIT,
				TEAM_ALL_NAME,
				CHARGE_PERSON_NAME,
				CHARGE_PERSON_CELL,
				TAX_NO,
				BANK_NAME,
				BANK_NO,
				BUSINESS_CATEGORY,
				GMT_CREATE,
				GMT_MODIFIED,
				CREATER,
				MODIFIER
			FROM hqyt_team
            WHERE 1=1
            <isNotEmpty property="teamId" prepend="and">
	               TEAM_ID = #teamId#
	        </isNotEmpty>
    </select>

    <!-- mapped statement for IbatisTeamDAO.queryAllTeamMsg -->
			 <select id="MS-TEAM-QUERY-ALL-TEAM-MSG" resultClass="java.util.HashMap">
	        SELECT 
				    TEAM_ID teamId,
					TEAM_NAME teamName
				FROM
					hqyt_team
				ORDER BY IS_TOP DESC , GMT_CREATE DESC, ID DESC
				<isNotEmpty prepend="" property="limit"> 
					limit #offset#,#limit#
				</isNotEmpty>
    </select>

</sqlMap>